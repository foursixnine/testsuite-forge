.PHONY: all
all:

.PHONY: black
black:
	black --check ./

.PHONY: tidy
tidy:
	black ./

.PHONY: pylint
pylint:
	pylint ./*.py

.PHONY: flake
flake:
	flake8 --isolated --exclude $(VENV) 

# .PHONY: test-with-coverage
# test-with-coverage:
# 	python3 -m pytest -v --cov=./openqabot --cov-report=xml --cov-report=term

# aggregate targets

.PHONY: lint
lint: pylint flake8

.PHONY: checkstyle
checkstyle: black lint

.PHONY: test
test: only-test checkstyle

DEV_REQUIREMENTS = $(shell if [ -f dev-requirements.txt ]; then echo "-r dev-requirements.txt"; else echo ""; fi)

VENV = $(shell basename $(CURDIR))-venv
.PHONY environment: 
	if [ ! -d "$(VENV)" ]; then virtualenv -p python3 $(VENV); fi
	. $(VENV)/bin/activate && pip install $(DEV_REQUIREMENTS)  -r requirements.txt

# Developers have bad memory, so we need to remind them to activate the virtualenv
# maybe use Makefile.VENV instead to get a shell with virtualenv

.PHONY: devel
devel: environment
	@echo "Please activate the virtualenv by running:"
	@echo "source $(VENV)/bin/activate"

 	shell=$$(basename $$SHELL); \
 	echo "Activating virtualenv for $$shell"; \
 	. $(VENV) && \
 	exec $($(SHELL) -l)
